<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Docs Editor</title>
  <base href="/" />
</head>
<body>
  <div id="nc-root"></div>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script src="https://unpkg.com/netlify-cms@^2.10.0/dist/netlify-cms.js"></script>
  <script>
    // ensure only loggedâ€‘in users proceed
    netlifyIdentity.init({ open_signup: true });
    netlifyIdentity.on('init', user => { if (!user) netlifyIdentity.open('login'); });
    
    // extract org & repo from query
    const params = new URLSearchParams(window.location.search);
    const org  = params.get('org');
    const repo = params.get('repo');

    // dynamically build the CMS config
    const config = {
      backend: {
        name: 'github',
        repo: `${org}/${repo}`,
        branch: 'main'
      },
      media_folder: 'docs/images',
      public_folder: '/images',
      collections: [{
        name: 'pages',
        label: 'Pages',
        folder: 'docs',
        create: true,
        slug: '{{slug}}',
        fields: [
          { label: 'Title', name: 'title', widget: 'string' },
          { label: 'Body',  name: 'body',  widget: 'markdown' }
        ]
      }]
    };

    // initialize Netlify CMS with our dynamic config
    CMS.init({ config });
  </script>
</body>
</html>
